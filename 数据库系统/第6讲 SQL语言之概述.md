# 数据库系统 战德辰
## 第6讲 SQL语言之概述
### SQL语言概述
**SQL语言的发展历史**
 * 1974年由Boyce和Chamber提出
 * 1975-1979年由San Jose研究室在System R首次实现, 称为Sequel -> SQL
 * 1986年ANSI/ISO推出SQL-86标准
 * 1989年ANSI/ISO推出SQL-89标准
 * 1992年进一步提出SQL标准: SQL-92, 也称SQL2(标准关系数据库语言)
 * 1999年进一步提出SQL标准: SQL-99, 也称SQL3(面向对象数据库/对象关系数据库)
 * SQL 2003/2006/2008(对数据库应用程序进行规范)
 * 另有SQL X/Open标准, 强调各厂商产品的可移植性, 只包含被各厂商广泛认可的操作 -> 标准使得用户可以学习标准规定的语言, 而无需关注具体的软件产品(具体应用依然略有差异)

**SQL语言的功能概述**
 * SQL语言是集DDL、DML、DCL于一体的数据库语言
 * SQL语言主要由9个单词引导的操作语句构成: 
   * **DDL**: Create, Alter, Drop - 模式的定义和删除
   * **DML**: Insert, Delete, Update, Select - 各种方式的更新与检索操作
   * **DCL**: Grant, Revoke - 安全性控制
 * 课程逐步递进: 交互式SQL -> 嵌入式SQL -> 动态SQL
 * **课程要求: 理解查询(增删改查)需求、用SQL精确表达**
### SQL语言之DDL-定义数据库
**建立数据库**: 包括 定义数据库和表(使用DDL), 向表中追加元组(使用DML)  
**创建数据库的简单语法形式**: create database 数据库名;  
**创建Table的简单语法形式**: create table 表名( 列名 数据类型 \[Primary key|Unique\] \[Not null\] \[,列名 数据类型 \[Not null\],...\])  
 * Primary key: 主键约束, 每张表只能创建一个。
 * Unique: 唯一性约束(即候选键), 每张表可以有多个。
 * Not null: 非空约束, 指该列不允许有空值出现。
 * 语法中的数据类型在SQL-92标准中被定义。
   * char(n): 固定长度字符串
   * varchar(n): 可变长度字符串
   * int: 整数, 有时不同系统为integer
   * numeric(p,q): 固定精度数字, 小数点左边p位,  右边p-q位
   * real: 浮点精度数字, 有时不同系统为float(n)
   * date: 日期 (ep. 2003-09-12)
   * time: 时间 (ep. 23:15:15:003)
* 和高级语言的数据类型总体一致, 但也有些差异

**向表中追加元组的简单语法形式**: insert into 表名\[(列名\[,列名\]...)\] values (值 \[,值\], ...);
 * 若列名未省略, 需与语句中列名的顺序一致; 若省略, 需与定义的列名顺序一致

**修正数据库**: alter table 表名 \[add {列名 数据类型,...}\] \[drop {完整性约束名}\] \[modify {列名 数据类型,...\]
 * add: 增加新列, drop: 删除完整性约束, modify: 修改列定义
 * **注意: 现在一般不再使用modify, 转而使用column修改。视频使用的SQL版本较老, 现今可能有部分语法更新, 以最新语法为准**  

**撤销基本表**: drop table 表名;  
**撤销数据库**: drop database 数据库名;  
有些数据库有操作多个数据库的能力, 对此可以以以下命令做切换:  
**指定当前数据库**: use 数据库名;  
**关闭当前数据库**: close 数据库名;  
### SQL语言之DML-操纵数据库
**检索语句的简单语法形式**: select 列名\[\[,列名\]...\] from 表名 \[where 检索条件\];
 * 在检索结果中可能有重复元组, 若要求无重复则需使用DISTINCT保留字。
 * 结果排序: order by 列名 \[asc|desc\] - asc或省略为升序, desc为降序
 * 模糊查询: 列名\[not\] like "字符串"
   * % 匹配零个或多个字符
   * _ 匹配任意单个字符
   * \\ 转义字符

**检索语句的多表联合查询**: select 列名 \[\[,列名\]...\] from 表名1,表名2,... where 检索条件;
 * 检索条件要包含连接的条件
 * 如两个表的属性名相同, 则需采用**表名.属性名**的方式来限定该属性名属于哪一张表
 * 如有表格重名/列名特别长的情况, 则需要用as设定别名以便区分(PS: 实际上在SQL中可以不添加as, 直接在空格后设定别名)

**增、删、改、查**
 * Insert: insert into 表名 (属性名\[, 属性名, ...\]) (值\[, 值, ...\])
 * Insert内可以嵌套Select语句
 * Delete: delete from 表名 \[where 条件表达式\]
 * 不添加条件表达式则会删除表中所有元组
 * Update: update 表名 set 列名=表达式 | (子查询) \[\[,列名=表达式|(子查询)\]\] \[where 条件表达式\];
 * 不添加where条件则会更新表中所有元组

**创建表(T-SQL语句)**: create table \[数据库名.所有者名.\]表名 ({<列名 数据类型>} \[缺省值\]\[约束\]\[是否为空\]);  
**创建、删除、修改约束: 在第9讲中详细介绍**  
![约束](imgs/image-25.png)  
### 典型DBMS交互环境 SQL Server介绍
SQL Server是Microsoft提供的一款关系数据库管理系统。
**系统数据库(SQL Server自带,自动安装)**
 * Master: 存储SQL Server中的元数据
 * Model: 模板数据库, 在创建新数据库时会复制此数据库作为基础
 * Msdb: 代理服务数据库
 * Tempdb: 临时数据库, 为临时数据提供存储空间

**SQL Server数据库**
 * 文件: 三种扩展名: 主数据库文件.mdf/辅助数据库文件.ndf/日志.ldf - 启动信息/所定义数据库的其它数据/事务日志文件
 * 页面: SQL Server存储的最小单位, 一页为8KB
 * 空间: 8个连续的页面即64KB数据, 是分配数据表存储空间的一种单位

**数据库授权**: grant 权限 on 表名 to 用户名  
 * 权限: select, update, insert, delete, exec, dri
### 总结
![章节重点与难点](imgs/image-24.png)  
![SQL: 结构化查询语言](imgs/image-26.png)  